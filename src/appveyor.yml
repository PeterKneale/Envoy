version: '0.1.{build}'
image: Visual Studio 2017
branches:
  only:
  - master
init:
  - cmd: git config --global core.autocrlf true
build_script:
  - cmd: dotnet restore ./src/Envoy/Envoy.csproj
  - cmd: dotnet publish ./src/Envoy/Envoy.csproj
test_script:
  - cmd: dotnet restore ./src/Envoy.Tests/Envoy.Tests.csproj
  - cmd: cd src/Envoy.Tests
  - cmd: dotnet test
artifacts:
  - path: '**\*.nupkg'
deploy:
  - provider: NuGet
    api_key:
      secure: 39TiDru9R2WsPYRl1ng1z5NQbI6A8tw+KfFlOE5KdT/4cTzKPlu8mjIud50s4Xce
    skip_symbols: false
    artifact: Envoy.nupkg
notifications:
  - provider: Email
    to:
      - peterkneale+envoy@gmail.com
    subject: 'Envoy: Build {{status}}'                 
    message: "{{message}}, {{commitId}}, ...""
    on_build_status_changed: true
